
#+TITLE: référence API Kangaro'O
#+AUTHOR: Brice Tonon
#+OPTIONS: ^:nil

* Authentification

** login

~POST /api/login~

Contenu attendu:
#+begin_src js
{
	"email":"email utilisateur",
	"password":"mot de passe"
}
#+end_src

Réponses possibles:
| code | réponse                                             |
|------+-----------------------------------------------------|
|  401 | err 12:"bad login"                                  |
|  200 | {"token":"token JWT", "name","fullname", "picture"} |

** inscription

~POST /api/signup~

Contenu attendu:
#+begin_src js
{
	"email":"email utilisateur",
	"password":"mot de passe",
	"name": "nom d'utilisateur",
	"fullname": "nom complet"
}
#+end_src

Réponses possibles:
| code | réponse                                           |
|------+---------------------------------------------------|
|  400 | err 10:'missing fields'                           |
|  201 | {"user":{utilisateur créé}, "token": "token JWT"} |

* profils utilisateur

** récupérer un profil

~GET /api/user/:id~

Réponses possibles:
| code | réponse            |
|------+--------------------|
|  404 | err 20:"not found" |
|  200 | {utilisateur}      |

** récupérer son propre profil

~GET /api/user/me~

fonctionne comme ~/api/user/:id~ mais renvoie l'utilisateur connecté

* groupes

** créer un groupe

~POST /api/group~

Contenu attendu:
#+begin_src js
{
	"name":"nom du groupe"
}
#+end_src

Réponses possibles:
| code | réponse                 |
|------+-------------------------|
|  400 | err 10:"missing fields" |
|  400 | err 13:"already exist"  |
|  201 | {groupe créé}           |

à faire: définir l'erreur si un groupe du même nom est créé (pour l'instant ça renvoie une erreur 500)

** afficher les groupes rejoint

~GET /api/group/joined~

affiche les groupes dans lequel l'utilisateur est enregistré

Réponse:
| code | réponse    |
|------+------------|
|  200 | [{groupe}] |

** annuaire des groupes

~GET /api/group/directory~

affiche les groupes visibles

Réponse:
| code | réponse    |
|------+------------|
|  200 | [{groupe}] |

** recherche de groupe

~GET /api/group/search?s=~

recherche dans les groupes visibles, la variable s correspond au terme à rechercher

Réponse:
| code | réponse    |
|------+------------|
|  200 | [{groupe}] |

** rejoindre un groupe

~POST /api/group/:id/join~

Réponses possibles:
| code | réponse                           |
|------+-----------------------------------|
|  403 | err 21:"not enough rights"        |
|  404 | err 20:"not found"                |
|  204 |                                   |

** quitter un groupe

~POST /api/group/:id/leave~

Réponses possibles:
| code | réponse                      |
|------+------------------------------|
|  404 | err 20:"not found"           |
|  403 | err 21:"not enough rights"   |
|  403 | err 22 "creator can't leave" |
|  204 |                              |

* canals

** créer un canal dans un groupe

~POST /api/group/:id/channel~

Contenu attendu:
#+begin_src js
{
	"name":"nom du canal"
}
#+end_src

Réponses possibles:
| code | réponse                    |
|------+----------------------------|
|  404 | err 20:"not found"         |
|  403 | err 21:"not enough rights" |
|  400 | err 13:"already exist"     |
|  201 | {channel}                  |

** voir les canals d'un groupe

~GET /api/group/:id/channel~

Réponses possibles:
| code | réponse                    |
|------+----------------------------|
|  403 | err 21:"not enough rights" |
|  404 | err 20:"not found"         |
|  200 | [{channel}]                |

* messages

** récupérer les messages

~GET /api/channel/:id/message?time=2023-07-21T10%3A04%3A34.389Z~

récupère les 50 derniers messages d'un channel si la variable time n'est pas défini

si time est défini, récupère les 50 derniers messages anterieurs à la date donnée

Réponses possibles:
| code | réponse                    |
|------+----------------------------|
|  403 | err 21:"not enough rights" |
|  200 | [{message}]                |
